# æ’è¡Œæ¦œåŠŸèƒ½å¼€å‘æ—¥å¿—

## å¼€å‘æ—¶é—´
2025-10-14

## åŠŸèƒ½æ¦‚è¿°
å®ç°ç”¨æˆ·åˆ·é¢˜æ’è¡Œæ¦œåŠŸèƒ½ï¼Œæ”¯æŒæŸ¥çœ‹å…¨ç«™ç”¨æˆ·æ’åå’Œä¸ªäººæ’åä¿¡æ¯ã€‚

## æŠ€æœ¯å®ç°

### åç«¯éƒ¨åˆ†

#### 1. æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆDTOï¼‰
- **æ–‡ä»¶**: `UserRankDTO.java`
- **å­—æ®µ**:
  - userId: ç”¨æˆ·ID
  - username: ç”¨æˆ·å
  - nickname: æ˜µç§°
  - avatar: å¤´åƒURL
  - acCount: ACé¢˜ç›®æ•°
  - submitCount: æäº¤æ€»æ•°
  - acRate: ACç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
  - rank: æ’å

#### 2. æ•°æ®è®¿é—®å±‚ï¼ˆMapperï¼‰
- **æ–‡ä»¶**: `SubmissionMapper.java`
- **æ–°å¢æ–¹æ³•**:
  - `selectUserRankList(int limit)`: æŸ¥è¯¢æ’è¡Œæ¦œåˆ—è¡¨
  - `selectUserRank(Long userId)`: æŸ¥è¯¢å•ä¸ªç”¨æˆ·ç»Ÿè®¡

- **SQLé€»è¾‘**:
```sql
SELECT 
  u.id as userId,
  u.username,
  u.nickname,
  u.avatar,
  COUNT(DISTINCT CASE WHEN s.status = 'AC' THEN s.question_id END) as acCount,
  COUNT(s.id) as submitCount,
  ROUND(COUNT(DISTINCT CASE WHEN s.status = 'AC' THEN s.question_id END) * 100.0 / NULLIF(COUNT(s.id), 0), 2) as acRate
FROM users u
LEFT JOIN submissions s ON u.id = s.user_id
WHERE u.status = 1
GROUP BY u.id
ORDER BY acCount DESC, submitCount ASC
LIMIT ?
```

- **æ’åè§„åˆ™**:
  1. æŒ‰ACé¢˜æ•°é™åºï¼ˆACè¶Šå¤šè¶Šé å‰ï¼‰
  2. ACæ•°ç›¸åŒæ—¶æŒ‰æäº¤æ€»æ•°å‡åºï¼ˆæäº¤è¶Šå°‘è¶Šé å‰ï¼‰

#### 3. ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆServiceï¼‰
- **æ–‡ä»¶**: `RankService.java`
- **æ–¹æ³•**:
  - `getUserRankList(int limit)`: è·å–å‰Nåç”¨æˆ·æ’è¡Œæ¦œï¼Œè‡ªåŠ¨è®¡ç®—æ’å
  - `getUserRank(Long userId)`: è·å–å•ä¸ªç”¨æˆ·æ’åä¿¡æ¯

#### 4. æ§åˆ¶å™¨ï¼ˆControllerï¼‰
- **æ–‡ä»¶**: `RankController.java`
- **APIæ¥å£**:
  - `GET /rank/list?limit=100`: è·å–æ’è¡Œæ¦œåˆ—è¡¨ï¼ˆé»˜è®¤å‰100åï¼Œæœ€å¤§500åï¼‰
  - `GET /rank/my`: è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„æ’åä¿¡æ¯ï¼ˆéœ€è¦JWTè®¤è¯ï¼‰

### å‰ç«¯éƒ¨åˆ†

#### 1. APIæ¥å£å°è£…
- **æ–‡ä»¶**: `api/index.js`
- **æ–°å¢å‡½æ•°**:
  - `getRankList(params)`: è·å–æ’è¡Œæ¦œåˆ—è¡¨
  - `getMyRank()`: è·å–æˆ‘çš„æ’å

#### 2. æ’è¡Œæ¦œé¡µé¢
- **æ–‡ä»¶**: `views/Ranking.vue`
- **åŠŸèƒ½ç‰¹æ€§**:
  - å±•ç¤ºTop 100ç”¨æˆ·æ’è¡Œæ¦œ
  - æ˜¾ç¤ºå½“å‰ç”¨æˆ·æ’åå¡ç‰‡ï¼ˆæ¸å˜èƒŒæ™¯ï¼‰
  - å‰ä¸‰åç”¨æˆ·æ˜¾ç¤ºå¥–ç‰Œå›¾æ ‡ï¼ˆğŸ¥‡ğŸ¥ˆğŸ¥‰ï¼‰
  - ä½¿ç”¨Element Plusè¡¨æ ¼ç»„ä»¶
  - ä½¿ç”¨è¿›åº¦æ¡å±•ç¤ºACç‡
  - å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯

- **UIç»„ä»¶**:
  - æˆ‘çš„æ’åå¡ç‰‡ï¼šæ¸å˜èƒŒæ™¯ã€å¤§æ•°å­—å±•ç¤º
  - æ’è¡Œæ¦œè¡¨æ ¼ï¼šç”¨æˆ·å¤´åƒã€æ˜µç§°ã€ACæ•°ã€æäº¤æ•°ã€ACç‡
  - åˆ·æ–°æŒ‰é’®ï¼šæ‰‹åŠ¨åˆ·æ–°æ’è¡Œæ¦œ

#### 3. è·¯ç”±é…ç½®
- **æ–‡ä»¶**: `router/index.js`
- **æ–°å¢è·¯ç”±**:
  - `/ranking`: æ’è¡Œæ¦œé¡µé¢ï¼ˆéœ€è¦ç™»å½•ï¼‰

#### 4. å¯¼èˆªèœå•
- **æ–‡ä»¶**: `components/Layout.vue`
- **ä¿®æ”¹**: åœ¨é¡¶éƒ¨å¯¼èˆªæ æ·»åŠ "æ’è¡Œæ¦œ"é“¾æ¥

## APIæµ‹è¯•ç»“æœ

### æµ‹è¯•å‘½ä»¤
```powershell
Invoke-RestMethod -Uri 'http://localhost:8080/api/rank/list?limit=5'
```

### æµ‹è¯•ç»“æœ
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": [
    {
      "userId": 7,
      "username": "zhouba",
      "nickname": "å°å‘¨",
      "avatar": "https://avatar.default.com/default.png",
      "acCount": 0,
      "submitCount": 0,
      "acRate": null,
      "rank": 1
    },
    // ... æ›´å¤šç”¨æˆ·æ•°æ®
  ]
}
```

**æµ‹è¯•ç»“è®º**: âœ“ APIæ¥å£æ­£å¸¸å·¥ä½œï¼Œæ•°æ®æ ¼å¼æ­£ç¡®

## æ–‡ä»¶å˜æ›´æ¸…å•

### åç«¯æ–°å¢æ–‡ä»¶ï¼ˆ3ä¸ªï¼‰
1. `backend/src/main/java/com/ylwy/dto/UserRankDTO.java` - ç”¨æˆ·æ’è¡Œæ¦œDTO
2. `backend/src/main/java/com/ylwy/service/RankService.java` - æ’è¡Œæ¦œæœåŠ¡
3. `backend/src/main/java/com/ylwy/controller/RankController.java` - æ’è¡Œæ¦œæ§åˆ¶å™¨

### åç«¯ä¿®æ”¹æ–‡ä»¶ï¼ˆ1ä¸ªï¼‰
4. `backend/src/main/java/com/ylwy/mapper/SubmissionMapper.java` - æ·»åŠ ç»Ÿè®¡æŸ¥è¯¢æ–¹æ³•

### å‰ç«¯æ–°å¢æ–‡ä»¶ï¼ˆ1ä¸ªï¼‰
5. `frontend/src/views/Ranking.vue` - æ’è¡Œæ¦œé¡µé¢ç»„ä»¶

### å‰ç«¯ä¿®æ”¹æ–‡ä»¶ï¼ˆ3ä¸ªï¼‰
6. `frontend/src/api/index.js` - æ·»åŠ æ’è¡Œæ¦œAPI
7. `frontend/src/router/index.js` - æ·»åŠ æ’è¡Œæ¦œè·¯ç”±
8. `frontend/src/components/Layout.vue` - æ·»åŠ å¯¼èˆªé“¾æ¥

## æŠ€æœ¯äº®ç‚¹

1. **é«˜æ•ˆSQLæŸ¥è¯¢**: ä½¿ç”¨LEFT JOINå’Œèšåˆå‡½æ•°ä¸€æ¬¡æ€§æŸ¥è¯¢ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯
2. **ç©ºå€¼å¤„ç†**: ä½¿ç”¨NULLIFé¿å…é™¤é›¶é”™è¯¯
3. **å»é‡ç»Ÿè®¡**: ä½¿ç”¨DISTINCTç¡®ä¿ACé¢˜æ•°ä¸é‡å¤è®¡ç®—
4. **MyBatisæ³¨è§£**: ä½¿ç”¨@Selectæ³¨è§£ç®€åŒ–Mapperé…ç½®
5. **Vue3 Composition API**: ä½¿ç”¨setupè¯­æ³•ç³–å’Œå“åº”å¼æ•°æ®
6. **Element Plusç»„ä»¶**: å……åˆ†åˆ©ç”¨UIç»„ä»¶åº“ï¼ˆè¡¨æ ¼ã€è¿›åº¦æ¡ã€æ ‡ç­¾ç­‰ï¼‰
7. **æ¸å˜è®¾è®¡**: ä½¿ç”¨Tailwind CSSæ¸å˜èƒŒæ™¯æå‡è§†è§‰æ•ˆæœ

## å¾…ä¼˜åŒ–é¡¹

1. **ç¼“å­˜æœºåˆ¶**: æ’è¡Œæ¦œæ•°æ®å¯ä»¥ä½¿ç”¨Redisç¼“å­˜ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢
2. **åˆ†é¡µåŠ è½½**: å½“ç”¨æˆ·æ•°é‡å¾ˆå¤§æ—¶ï¼Œå‰ç«¯å¯ä»¥å®ç°è™šæ‹Ÿæ»šåŠ¨
3. **å®æ—¶æ›´æ–°**: ä½¿ç”¨WebSocketå®æ—¶æ¨é€æ’åå˜åŒ–
4. **æ’åè®¡ç®—ä¼˜åŒ–**: å¯ä»¥é¢„è®¡ç®—æ’åå­˜å‚¨åˆ°Redisï¼Œå®šæ—¶æ›´æ–°
5. **å¤šç»´åº¦æ’å**: æ”¯æŒæŒ‰ç§‘ç›®ã€æŒ‰å­¦æ ¡ç­‰ç»´åº¦çš„æ’è¡Œæ¦œ

## ä¸‹ä¸€æ­¥è®¡åˆ’

1. **ä¸ªäººä¸­å¿ƒé¡µé¢**: å±•ç¤ºä¸ªäººåˆ·é¢˜ç»Ÿè®¡ã€æˆé•¿æ›²çº¿
2. **åšé¢˜ç»Ÿè®¡å›¾è¡¨**: ä½¿ç”¨EChartså±•ç¤ºåšé¢˜è¶‹åŠ¿
3. **æˆå°±ç³»ç»Ÿ**: è®¾ç½®å‹‹ç« ã€ç§°å·ç­‰æ¿€åŠ±æœºåˆ¶
4. **ç¤¾äº¤åŠŸèƒ½**: å…³æ³¨ç”¨æˆ·ã€æŸ¥çœ‹åŠ¨æ€

## æµ‹è¯•æ¸…å•

- [x] åç«¯APIç¼–è¯‘é€šè¿‡
- [x] æ’è¡Œæ¦œåˆ—è¡¨æ¥å£æµ‹è¯•é€šè¿‡
- [x] å‰ç«¯é¡µé¢ç¼–è¯‘é€šè¿‡
- [x] å‰ç«¯è·¯ç”±é…ç½®æ­£ç¡®
- [x] å¯¼èˆªèœå•æ˜¾ç¤ºæ­£ç¡®
- [ ] æµè§ˆå™¨ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆéœ€è¦ç”¨æˆ·æ‰‹åŠ¨éªŒè¯ï¼‰
- [ ] ç§»åŠ¨ç«¯å“åº”å¼æµ‹è¯•
